<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../style/main.css">
    <title>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</title>
    <style>
    @font-face {
        font-family: minecraft;
        src: url('../font/Minecraft-Default.otf');
    }
    @font-face {
        font-family: minecraft-ten;
        src: url('../font/Minecraft-Ten.ttf');
    }
    @font-face {
        font-family: minecraft-five;
        src: url('../font/Minecraft-Five.ttf');
    }
        body { font-family: Arial, sans-serif; text-align: center;  }
        h2 { color: #333; }
        table { width: 50%; margin: 20px auto; border-collapse: collapse; background: white; }
        th, td { padding: 10px; border: 1px solid #ddd; }
        th { background: #3498db; color: white; }
        tbody.link {
    color: #0088FF;
     font-family: minecraft-five;
}
    </style>
</head>
<body>

    <h2>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆÙ†Ù‚Ø§Ø·Ù‡Ù…</h2>
    <table>
        <thead>
            <tr>
                <th>Ø§Ù„Ø§Ø³Ù…</th>
                <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
            </tr>
        </thead>
   <tbody id="userList">
    <tr><td colspan="2">Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</td></tr>
</tbody>
    </table>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBf-HKpI4G5p6E0xP1OHGLxtDTGwE_0gg0",
            authDomain: "minecraft-community-4fd3d.firebaseapp.com",
            projectId: "minecraft-community-4fd3d",
            storageBucket: "minecraft-community-4fd3d.firebasestorage.app",
            messagingSenderId: "550140131027",
            appId: "1:550140131027:web:a5186726cf5372e138c626",
            measurementId: "G-F18SFG2LMZ"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Ø¬Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù…Ù† Firestore ÙˆØªØ­Ø¯ÙŠØ«Ù‡Ø§ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
        const userList = document.getElementById("userList");

        onSnapshot(collection(db, "users"), (snapshot) => {
    userList.innerHTML = ""; // ØªÙØ±ÙŠØº Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«
// âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„Ø§Ù‹
const activeUser = localStorage.getItem("activeUser");

if (!activeUser) {
    alert("ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹!");
    window.location.href = "login.html"; // ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ø¯ÙŠÙƒ
}
    if (snapshot.empty) {
        userList.innerHTML = "<tr><td colspan='2'>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</td></tr>";
    } else {
        const activeUser = localStorage.getItem("activeUser"); // Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø³Ø¬Ù„

        snapshot.forEach((doc) => {
            const username = doc.id; // Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            const points = doc.data().points || 0; // Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ù‚Ø§Ø·

            console.log(`ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰: ${username} - Ù†Ù‚Ø§Ø·: ${points}`);

            // ğŸ”¹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø³Ø¬Ù„ØŒ Ù„Ø§ ØªØ¬Ø¹Ù„Ù‡ Ø±Ø§Ø¨Ø·Ù‹Ø§
            const row = (username === activeUser)
                ? `<tr><td><strong>${username}</strong> (Ø£Ù†Øª)</td><td>${points}</td></tr>`
                : `<tr><td><a href="chat_beta.html?user=${encodeURIComponent(username)}">${username}</a></td><td>${points}</td></tr>`;

            userList.innerHTML += row;
            
        });
    }
});
    </script>

</body>
</html>