<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gold Trading Platform</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #FFD700;
      --primary-dark: #D4AF37;
      --secondary: #1E1E1E;
      --dark: #121212;
      --light: #F5F5F5;
      --success: #00C853;
      --danger: #D32F2F;
      --info: #2196F3;
      --warning: #FFA000;
      --card-bg: #1E1E1E;
      --border-radius: 8px;
      --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--dark);
      color: var(--light);
      line-height: 1.6;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 215, 0, 0.2);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo i {
      color: var(--primary);
      font-size: 1.8rem;
    }

    .logo h1 {
      font-size: 1.5rem;
      font-weight: 600;
      background: linear-gradient(to right, #FFD700, #D4AF37);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .user-points {
      background-color: var(--secondary);
      padding: 8px 12px;
      border-radius: var(--border-radius);
      font-weight: 600;
      color: var(--primary);
    }

    .price-card {
      background-color: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 20px;
      margin-bottom: 25px;
      box-shadow: var(--box-shadow);
      border-left: 4px solid var(--primary);
      position: relative;
      overflow: hidden;
    }

    .price-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .asset-name {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .asset-name i {
      color: var(--primary);
      font-size: 1.5rem;
    }

    .asset-name h2 {
      font-size: 1.3rem;
      font-weight: 600;
    }

    .price-change {
      display: flex;
      align-items: center;
      gap: 5px;
      font-weight: 600;
    }

    .price-up {
      color: var(--success);
    }

    .price-down {
      color: var(--danger);
    }

    .price-value {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 5px;
      color: var(--primary);
    }

    .price-subtext {
      color: #aaa;
      font-size: 0.9rem;
    }

    .trading-form {
      background-color: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 20px;
      margin-bottom: 25px;
      box-shadow: var(--box-shadow);
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .input-group {
      display: flex;
      align-items: center;
      background-color: var(--secondary);
      border-radius: var(--border-radius);
      overflow: hidden;
    }

    .input-group input {
      flex: 1;
      padding: 12px 15px;
      border: none;
      background-color: transparent;
      color: var(--light);
      font-size: 1rem;
    }

    .input-group input:disabled {
      opacity: 0.7;
    }

    .input-group span {
      padding: 0 15px;
      color: #aaa;
      font-weight: 500;
    }

    .action-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 20px;
    }

    .btn {
      padding: 12px;
      border: none;
      border-radius: var(--border-radius);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-buy {
      background-color: var(--success);
      color: white;
    }

    .btn-sell {
      background-color: var(--danger);
      color: white;
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }

    .btn-secondary {
      background-color: var(--secondary);
      color: var(--light);
    }

    .btn-warning {
      background-color: var(--warning);
      color: white;
    }

    .history-section {
      background-color: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: var(--box-shadow);
      margin-bottom: 25px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .section-title {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .refresh-btn {
      background: none;
      border: none;
      color: var(--primary);
      cursor: pointer;
      font-size: 1rem;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .trade-list {
      max-height: 300px;
      overflow-y: auto;
    }

    .trade-item {
      padding: 15px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .trade-item:last-child {
      border-bottom: none;
    }

    .trade-type {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .trade-type-buy .trade-icon {
      color: var(--success);
    }

    .trade-type-sell .trade-icon {
      color: var(--danger);
    }

    .trade-details {
      text-align: right;
    }

    .trade-amount {
      font-weight: 600;
      margin-bottom: 3px;
    }

    .trade-price {
      color: #aaa;
      font-size: 0.9rem;
    }

    .trade-time {
      color: #777;
      font-size: 0.8rem;
    }

    .empty-history {
      text-align: center;
      padding: 30px 0;
      color: #777;
    }

    .status-card {
      background-color: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: var(--box-shadow);
      border-left: 4px solid var(--info);
    }

    .status-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .status-title {
      font-weight: 600;
      color: var(--info);
    }

    .status-content {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .status-item {
      display: flex;
      justify-content: space-between;
    }

    .status-label {
      color: #aaa;
    }

    .status-value {
      font-weight: 500;
    }

    .progress-container {
      width: 100%;
      height: 8px;
      background-color: var(--secondary);
      border-radius: 4px;
      margin-top: 10px;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(to right, var(--primary-dark), var(--primary));
      border-radius: 4px;
      transition: width 0.3s ease;
    }

    .tax-notice {
      font-size: 0.8rem;
      color: #aaa;
      margin-top: 10px;
      text-align: center;
    }

    .inventory-section {
      background-color: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: var(--box-shadow);
      margin-bottom: 25px;
    }

    .inventory-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .inventory-item:last-child {
      border-bottom: none;
    }

    .inventory-asset {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .inventory-icon {
      color: var(--primary);
      font-size: 1.2rem;
    }

    .inventory-actions {
      display: flex;
      gap: 8px;
    }

    .btn-sm {
      padding: 6px 10px;
      font-size: 0.8rem;
    }

    /* Animations */
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .pulse {
      animation: pulse 1.5s infinite;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
      20%, 40%, 60%, 80% { transform: translateX(3px); }
    }

    .shake {
      animation: shake 0.5s;
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 20px;
      border-radius: var(--border-radius);
      color: white;
      font-weight: 500;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease;
      max-width: 90%;
      text-align: center;
    }

    .notification.show {
      opacity: 1;
    }

    .notification.success {
      background-color: var(--success);
    }

    .notification.error {
      background-color: var(--danger);
    }

    .notification.warning {
      background-color: var(--warning);
    }

    .notification.info {
      background-color: var(--info);
    }

    /* Scrollbar styling */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: var(--secondary);
      border-radius: 3px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 3px;
    }

    /* Responsive design */
    @media (max-width: 480px) {
      .container {
        padding: 15px;
      }
      
      header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .price-value {
        font-size: 2rem;
      }
      
      .action-buttons {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <i class="fas fa-coins"></i>
        <h1>Gold Trader Pro</h1>
      </div>
      <div class="user-info">
        <div class="user-points" id="pointsDisplay">
          <i class="fas fa-wallet"></i> <span id="userPoints">--</span> pts
        </div>
      </div>
    </header>

    <div class="status-card">
      <div class="status-header">
        <h3 class="status-title">Trading Status</h3>
        <span id="marketStatus" class="status-value">Open</span>
      </div>
      <div class="status-content">
        <div class="status-item">
          <span class="status-label">Next Points Reward:</span>
          <span class="status-value" id="nextRewardTime">--</span>
        </div>
        <div class="progress-container">
          <div class="progress-bar" id="rewardProgress"></div>
        </div>
        <div class="status-item">
          <span class="status-label">Daily Points Limit:</span>
          <span class="status-value" id="pointsLimit">--</span>
        </div>
        <button class="btn btn-secondary btn-sm" id="claimRewardBtn" disabled>
          <i class="fas fa-gift"></i> Claim Points
        </button>
      </div>
    </div>

    <div class="price-card">
      <div class="price-header">
        <div class="asset-name">
          <i class="fas fa-gem"></i>
          <h2>Gold (XAU)</h2>
        </div>
        <div class="price-change" id="priceChange">
          <i class="fas fa-arrow-up"></i>
          <span>+0.5%</span>
        </div>
      </div>
      <div class="price-value" id="priceDisplay">--</div>
      <div class="price-subtext">Live market price - updated every 3 seconds</div>
    </div>

    <div class="inventory-section">
      <div class="section-header">
        <h3 class="section-title">Your Gold Inventory</h3>
      </div>
      <div id="inventoryList">
        <div class="inventory-item">
          <div class="inventory-asset">
            <i class="fas fa-gem inventory-icon"></i>
            <span>Gold (XAU)</span>
          </div>
          <div>
            <span id="goldAmount">0.00</span>g
          </div>
        </div>
      </div>
    </div>

    <div class="trading-form">
      <div class="form-group">
        <label for="tradeAmount">Trade Amount (grams)</label>
        <div class="input-group">
          <input type="number" id="tradeAmount" placeholder="Enter amount" min="1" step="1">
          <span>g</span>
        </div>
      </div>
      
      <div class="form-group">
        <label>Estimated Value</label>
        <div class="input-group">
          <input type="text" id="estimatedValue" placeholder="--" readonly>
          <span>pts</span>
        </div>
      </div>

      <div class="form-group">
        <label>Transaction Fee (2.5%)</label>
        <div class="input-group">
          <input type="text" id="transactionFee" placeholder="--" readonly>
          <span>pts</span>
        </div>
      </div>
      
      <div class="action-buttons">
        <button class="btn btn-buy" id="buyButton">
          <i class="fas fa-shopping-cart"></i> Buy
        </button>
        <button class="btn btn-sell" id="sellButton" disabled>
          <i class="fas fa-money-bill-wave"></i> Sell
        </button>
      </div>
      <div class="tax-notice">
        All trades are subject to a 2.5% transaction fee
      </div>
    </div>

    <div class="history-section">
      <div class="section-header">
        <h3 class="section-title">Trade History</h3>
        <button class="refresh-btn" id="refreshHistory">
          <i class="fas fa-sync-alt"></i> Refresh
        </button>
      </div>
      
      <div class="trade-list" id="tradeHistory">
        <div class="empty-history">No trades yet</div>
      </div>
    </div>

    <div class="notification" id="notification"></div>
  </div>

  <script type="module">
    // Simulated database - in a real app, you would use Firebase or another backend
    const db = {
      users: {},
      trades: []
    };

    // Get active user from localStorage or prompt for login
    let activeUser = localStorage.getItem('activeUser');
    if (!activeUser) {
      // For demo purposes, we'll create a temporary user
      activeUser = `user_${Math.floor(Math.random() * 10000)}`;
      localStorage.setItem('activeUser', activeUser);
      
      // Initialize user data
      db.users[activeUser] = {
        points: 100, // Starting points
        gold: 0, // Grams of gold
        lastRewardClaim: 0,
        dailyPointsEarned: 0,
        dailyPointsLimit: 500
      };
    } else if (!db.users[activeUser]) {
      // Initialize if not exists
      db.users[activeUser] = {
        points: 100,
        gold: 0,
        lastRewardClaim: 0,
        dailyPointsEarned: 0,
        dailyPointsLimit: 500
      };
    }

    // DOM Elements
    const priceDisplay = document.getElementById('priceDisplay');
    const priceChange = document.getElementById('priceChange');
    const tradeAmountInput = document.getElementById('tradeAmount');
    const estimatedValue = document.getElementById('estimatedValue');
    const transactionFee = document.getElementById('transactionFee');
    const pointsDisplay = document.getElementById('userPoints');
    const goldAmountDisplay = document.getElementById('goldAmount');
    const tradeHistory = document.getElementById('tradeHistory');
    const refreshHistoryBtn = document.getElementById('refreshHistory');
    const buyButton = document.getElementById('buyButton');
    const sellButton = document.getElementById('sellButton');
    const claimRewardBtn = document.getElementById('claimRewardBtn');
    const nextRewardTime = document.getElementById('nextRewardTime');
    const rewardProgress = document.getElementById('rewardProgress');
    const pointsLimit = document.getElementById('pointsLimit');
    const marketStatus = document.getElementById('marketStatus');
    const notification = document.getElementById('notification');

    // Trading variables
    let currentPrice = 10.0;
    let previousPrice = 10.0;
    let priceChangeInterval;
    let rewardInterval;
    let marketOpen = true;
    let rewardCooldown = 60; // 60 seconds cooldown for rewards
    let currentCooldown = 0;
    let dailyPointsResetTime = 0;

    // Initialize the page
    document.addEventListener('DOMContentLoaded', () => {
      fetchUserData();
      startPriceSimulation();
      startRewardSystem();
      checkMarketHours();
      
      // Add event listeners
      tradeAmountInput.addEventListener('input', updateEstimatedValue);
      refreshHistoryBtn.addEventListener('click', () => {
        fetchUserData();
        refreshHistoryBtn.classList.add('pulse');
        setTimeout(() => refreshHistoryBtn.classList.remove('pulse'), 1000);
      });
      
      claimRewardBtn.addEventListener('click', claimPointsReward);
    });

    // Show notification
    function showNotification(message, type) {
      notification.textContent = message;
      notification.className = `notification ${type} show`;
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // Simulate market hours (open/close)
    function checkMarketHours() {
      const now = new Date();
      const hours = now.getHours();
      
      // Market is open from 8AM to 10PM (for demo purposes)
      if (hours >= 8 && hours < 22) {
        marketOpen = true;
        marketStatus.textContent = "Open";
        marketStatus.style.color = "var(--success)";
      } else {
        marketOpen = false;
        marketStatus.textContent = "Closed";
        marketStatus.style.color = "var(--danger)";
        showNotification("Market is currently closed. Trading will resume at 8AM.", "warning");
      }
    }

    // Simulate live price changes with more realistic volatility
    function startPriceSimulation() {
      // Initial price
      simulatePrice();
      
      // Update price every 3 seconds
      priceChangeInterval = setInterval(simulatePrice, 3000);
    }

    function simulatePrice() {
      previousPrice = currentPrice;
      
      // More realistic price changes with occasional spikes/dips
      let change;
      if (Math.random() < 0.1) {
        // 10% chance of a significant move
        change = (Math.random() - 0.5) * 3;
      } else {
        // Normal fluctuation
        change = (Math.random() - 0.5) * 1.2;
      }
      
      // Apply change with some momentum effect
      currentPrice = Math.max(1.0, currentPrice + change);
      
      updatePriceDisplay();
    }

    function updatePriceDisplay() {
      // Update price display with animation
      priceDisplay.textContent = currentPrice.toFixed(2);
      priceDisplay.classList.add('pulse');
      setTimeout(() => priceDisplay.classList.remove('pulse'), 1000);
      
      // Update price change indicator
      const changePercent = ((currentPrice - previousPrice) / previousPrice * 100).toFixed(2);
      const changeElement = priceChange.querySelector('span');
      const iconElement = priceChange.querySelector('i');
      
      if (currentPrice > previousPrice) {
        priceChange.className = 'price-change price-up';
        iconElement.className = 'fas fa-arrow-up';
        changeElement.textContent = `+${changePercent}%`;
      } else if (currentPrice < previousPrice) {
        priceChange.className = 'price-change price-down';
        iconElement.className = 'fas fa-arrow-down';
        changeElement.textContent = `${changePercent}%`;
      } else {
        priceChange.className = 'price-change';
        iconElement.className = 'fas fa-equals';
        changeElement.textContent = `0.00%`;
      }
      
      // Update estimated value if there's an amount entered
      if (tradeAmountInput.value) {
        updateEstimatedValue();
      }
    }

    // Calculate estimated trade value with fees
    function updateEstimatedValue() {
      const amount = parseFloat(tradeAmountInput.value);
      if (!isNaN(amount)) {
        const value = amount * currentPrice;
        const fee = value * 0.025; // 2.5% transaction fee
        
        estimatedValue.value = value.toFixed(2);
        transactionFee.value = fee.toFixed(2);
      } else {
        estimatedValue.value = '--';
        transactionFee.value = '--';
      }
    }

    // Fetch user data
    function fetchUserData() {
      const user = db.users[activeUser];
      
      // Update points display
      pointsDisplay.textContent = user.points.toFixed(2);
      
      // Update gold inventory
      goldAmountDisplay.textContent = user.gold.toFixed(2);
      
      // Update sell button state
      sellButton.disabled = user.gold <= 0;
      
      // Update daily points limit
      pointsLimit.textContent = `${user.dailyPointsEarned}/${user.dailyPointsLimit}`;
      
      // Load trade history
      loadTradeHistory();
    }

    // Start the reward system (points over time)
    function startRewardSystem() {
      updateRewardDisplay();
      
      // Update cooldown every second
      rewardInterval = setInterval(() => {
        const now = Math.floor(Date.now() / 1000);
        const user = db.users[activeUser];
        
        // Check if daily points need reset
        if (now - dailyPointsResetTime >= 86400) { // 24 hours
          user.dailyPointsEarned = 0;
          dailyPointsResetTime = now;
          showNotification("Daily points limit has been reset!", "info");
        }
        
        // Update reward cooldown
        if (now - user.lastRewardClaim >= rewardCooldown) {
          currentCooldown = 0;
          claimRewardBtn.disabled = false;
        } else {
          currentCooldown = rewardCooldown - (now - user.lastRewardClaim);
          claimRewardBtn.disabled = true;
        }
        
        updateRewardDisplay();
      }, 1000);
    }

    function updateRewardDisplay() {
      const progressPercent = ((rewardCooldown - currentCooldown) / rewardCooldown) * 100;
      rewardProgress.style.width = `${progressPercent}%`;
      
      if (currentCooldown <= 0) {
        nextRewardTime.textContent = "Ready!";
        claimRewardBtn.disabled = false;
      } else {
        nextRewardTime.textContent = `${currentCooldown}s`;
        claimRewardBtn.disabled = true;
      }
    }

    // Claim points reward
    function claimPointsReward() {
      const user = db.users[activeUser];
      const rewardAmount = 25; // Fixed reward amount
      
      if (user.dailyPointsEarned + rewardAmount > user.dailyPointsLimit) {
        showNotification("You've reached your daily points limit!", "error");
        return;
      }
      
      user.points += rewardAmount;
      user.dailyPointsEarned += rewardAmount;
      user.lastRewardClaim = Math.floor(Date.now() / 1000);
      currentCooldown = rewardCooldown;
      
      fetchUserData();
      showNotification(`+${rewardAmount} points claimed!`, "success");
      claimRewardBtn.disabled = true;
    }

    // Execute trade with more realistic conditions
    async function executeTrade(type) {
      const amount = parseFloat(tradeAmountInput.value);
      if (isNaN(amount)) {
        showNotification('Please enter a valid amount', 'error');
        tradeAmountInput.focus();
        return;
      }

      if (amount <= 0) {
        showNotification('Amount must be greater than zero', 'error');
        return;
      }

      if (!marketOpen) {
        showNotification('Trading is only available during market hours (8AM-10PM)', 'error');
        return;
      }

      try {
        const user = db.users[activeUser];
        const totalCost = amount * currentPrice;
        const fee = totalCost * 0.025; // 2.5% transaction fee
        const totalWithFee = totalCost + fee;

        if (type === "buy") {
          if (user.points < totalWithFee) {
            showNotification(`Insufficient points. You need ${totalWithFee.toFixed(2)} pts (including fee)`, 'error');
            return;
          }

          // Random chance of price change during execution (slippage simulation)
          if (Math.random() < 0.3) {
            const slippage = (Math.random() * 0.02) - 0.01; // -1% to +1% slippage
            const executedPrice = currentPrice * (1 + slippage);
            const executedCost = amount * executedPrice;
            const executedFee = executedCost * 0.025;
            
            if (user.points < executedCost + executedFee) {
              showNotification('Trade failed due to price movement (slippage)', 'error');
              return;
            }
            
            user.points -= (executedCost + executedFee);
            user.gold += amount;
            
            showNotification(`Bought ${amount}g at ${executedPrice.toFixed(2)} pts/g (with slippage)`, 'warning');
          } else {
            user.points -= totalWithFee;
            user.gold += amount;
          }
        } else { // Sell
          if (user.gold < amount) {
            showNotification(`Insufficient gold. You only have ${user.gold.toFixed(2)}g`, 'error');
            return;
          }

          // Random chance of price change during execution (slippage simulation)
          if (Math.random() < 0.3) {
            const slippage = (Math.random() * 0.02) - 0.01; // -1% to +1% slippage
            const executedPrice = currentPrice * (1 + slippage);
            const executedValue = amount * executedPrice;
            const executedFee = executedValue * 0.025;
            
            user.points += (executedValue - executedFee);
            user.gold -= amount;
            
            showNotification(`Sold ${amount}g at ${executedPrice.toFixed(2)} pts/g (with slippage)`, 'warning');
          } else {
            user.points += (totalCost - fee);
            user.gold -= amount;
          }
        }

        // Record the trade
        const trade = {
          user: activeUser,
          type,
          asset: "gold",
          points: totalCost,
          fee: fee,
          amount,
          price: currentPrice,
          timestamp: new Date()
        };
        
        db.trades.unshift(trade); // Add to beginning of array
        if (db.trades.length > 20) db.trades.pop(); // Keep only last 20 trades

        // Show success notification
        showNotification(
          `${type === 'buy' ? 'Purchase' : 'Sale'} of ${amount}g gold completed!`,
          'success'
        );

        // Reset form
        tradeAmountInput.value = '';
        estimatedValue.value = '--';
        transactionFee.value = '--';
        
        // Update UI
        fetchUserData();

      } catch (error) {
        console.error('Error executing trade:', error);
        showNotification('Failed to complete trade', 'error');
      }
    }

    // Load trade history
    function loadTradeHistory() {
      const userTrades = db.trades.filter(trade => trade.user === activeUser);
      
      if (userTrades.length === 0) {
        tradeHistory.innerHTML = '<div class="empty-history">No trades yet</div>';
        return;
      }

      tradeHistory.innerHTML = '';
      userTrades.forEach(trade => {
        const tradeItem = document.createElement('div');
        tradeItem.className = 'trade-item';
        
        const typeClass = trade.type === 'buy' ? 'trade-type-buy' : 'trade-type-sell';
        
        tradeItem.innerHTML = `
          <div class="trade-type ${typeClass}">
            <i class="fas ${trade.type === 'buy' ? 'fa-arrow-circle-up' : 'fa-arrow-circle-down'} trade-icon"></i>
            <span>${trade.type.toUpperCase()}</span>
          </div>
          <div class="trade-details">
            <div class="trade-amount">${trade.amount}g</div>
            <div class="trade-price">${trade.points.toFixed(2)} pts (fee: ${trade.fee.toFixed(2)})</div>
            <div class="trade-time">${formatTime(trade.timestamp)}</div>
          </div>
        `;
        
        tradeHistory.appendChild(tradeItem);
      });
    }

    // Format time for display
    function formatTime(date) {
      return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }

    // Event listeners for buttons
    buyButton.addEventListener('click', () => executeTrade("buy"));
    sellButton.addEventListener('click', () => executeTrade("sell"));

    // Initialize
    fetchUserData();
  </script>
</body>
</html>