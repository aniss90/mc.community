<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="stylesheet" href="../style/main.css">
    <title>  Forget password</title>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        @font-face {
      font-family: minecraft;
      src: url('../font/Minecraft-Default.otf');
    }
    @font-face {
      font-family: minecraft-ten;
      src: url('../font/Minecraft-Ten.ttf');
    }
    @font-face {
      font-family: minecraft-five;
      src: url('../font/Minecraft-Five.ttf');
    }
    

        button {
            cursor: pointer;
            padding: 10px;
 
        }
        
        #emailDisplay {
            font-weight: bold;
            margin-top: 10px;
            
        }
        #fetchEmailBtn{
          background-color: #AEAEAE;
          border: 2px solid #2F2F2F;
          transition: all 0.3s ease;
        }
        #fetchEmailBtn:hover{
          background-color: #2B2B2B;
          border: 2px solid #9D9897;
        box-shadow: 4px 0px 15px #8E8E8E;
        color: #FFFFFF;
        }
        #sendPasswordBtn {
            display: none;
            width: 100%;
          text-align: center;
          background-color: #159227;
          border: 2px solid #459D52;
            color: #DFE9E1;
        transition: all 0.3s ease;
        }
        #sendPasswordBtn:hover{
          background-color: #02340A;
          border: 2px solid #91FFA1;
        }
        p {
          color: #FFFFFF
        }
        h2 {
          color: #FFFFFF
        } 
        label {
          color: #FFFFFF
        }
    </style>
</head>
<body>
   
  <div class="header">forget password
  <img src="../icons/gif_test-83efe.gif" height="30">
  <button class="back" id="backButton" type="button" onclick="goBack()"></button>
  </div>
      <div class="content">
       <div class="description"> 
      <br>
     
      <p><h2>Recover your password </h2></p> 
     <label for="username">Your username :</label>
 
   <p>   <input type="text" id="username" placeholder=" Enter your username  ">
   </p> 
        <br>  
        <button  id="fetchEmailBtn">Show the email account </button>
        <p id="emailDisplay"></p> 
        <button id="sendPasswordBtn">  send the password</button>
      
    </div>
  </div> 
      <script>
  emailjs.init("XJZUq8LRFG1aasSHu"); // Ù…ÙØªØ§Ø­Ùƒ Ø§Ù„Ø¹Ø§Ù… Ù…Ù† EmailJS
</script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        // Ø¥Ø¹Ø¯Ø§Ø¯ Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBf-HKpI4G5p6E0xP1OHGLxtDTGwE_0gg0",
            authDomain: "minecraft-community-4fd3d.firebaseapp.com",
            projectId: "minecraft-community-4fd3d",
            storageBucket: "minecraft-community-4fd3d.firebasestorage.app",
            messagingSenderId: "550140131027",
            appId: "1:550140131027:web:a5186726cf5372e138c626",
            measurementId: "G-F18SFG2LMZ"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let currentEmail = "";
        let currentPassword = "";

        // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
        document.getElementById("fetchEmailBtn").addEventListener("click", async () => {
            const username = document.getElementById("username").value.trim();
            const emailDisplay = document.getElementById("emailDisplay");
            const sendPasswordBtn = document.getElementById("sendPasswordBtn");

            if (!username) {
                emailDisplay.textContent = "âŒ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…!";
                emailDisplay.style.color = "red";
                sendPasswordBtn.style.display = "none";
                return;
            }

            const userRef = doc(db, "users", username);
            const userSnap = await getDoc(userRef);

            if (userSnap.exists()) {
                currentEmail = userSnap.data().email;
                currentPassword = userSnap.data().password;

                emailDisplay.textContent = `ğŸ“§ your email it's : ${currentEmail}`;
                emailDisplay.style.color = "green";
                sendPasswordBtn.style.display = "block"; // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
            } else {
                emailDisplay.textContent = "âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!";
                emailDisplay.style.color = "red";
                sendPasswordBtn.style.display = "none";
            }
        });

        // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø¥Ø±Ø³Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±
        // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
document.getElementById("sendPasswordBtn").addEventListener("click", async () => {
  if (!currentEmail || !currentPassword) {
    alert("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨!");
    return;
  }

  const username = document.getElementById("username").value.trim();

  // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„ØµÙˆØ±Ø© Ù…Ù† Firestore Ø£ÙŠØ¶Ù‹Ø§
  const userRef = doc(db, "users", username);
  const userSnap = await getDoc(userRef);
  const photoURL = userSnap.data().photoURL || "https://default-image.png";

  emailjs.send("service_y3lbl2i", "template_6qbt5hl", {
    to_email: currentEmail,
    user_name: username,
    password: currentPassword,
  }, "XJZUq8LRFG1aasSHu")
  .then(() => {
    alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ!");
  })
  .catch(error => {
    console.error("âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„:", error);
    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ!");
  });
});

    </script>
    <script>
    emailjs.init("XJZUq8LRFG1aasSHu");
</script>
      <script>
  function goBack() {
    if (window.history.length > 1) {
      window.history.back();
    } else {
      window.location.href = '/'; // ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù…ÙˆÙ‚Ø¹Ùƒ
    }
  }
</script>

</body>
</html>