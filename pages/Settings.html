<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../style/main.css">
  <link rel="icon" type="image/x-icon" href="../icons/Setting_icon.png">
  <title>User Settings</title>
     <!-- Open Graph Meta Tags -->
<!-- Dynamic Meta Tags -->
<!-- Dynamic Meta Tags -->
<meta property="og:type" content="profile">
<meta property="og:url" content="">
<meta property="og:title" content="">
<meta property="og:description" content="">
<meta property="og:image" content="">
<meta property="og:site_name" content="mc co">
<meta name="twitter:card" content="summary_large_image">
  <style>
    @font-face {
      font-family: minecraft;
      src: url('../font/Minecraft-Default.otf');
    }
    @font-face {
      font-family: minecraft-ten;
      src: url('../font/Minecraft-Ten.ttf');
    }
    @font-face {
      font-family: minecraft-five;
      src: url('../font/Minecraft-Five.ttf');
    }
    @font-face {
      font-family: MinecraftFive-Regular;
      src: url('../font/MinecraftFive-Regular.ttf');
    }
    
  
    
    
    .settings-container {
      display: flex;
      flex-direction: column;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      gap: 20px;
    }
    
    .profile-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      background-color: #262626;
      padding: 20px;
      border-radius: 5px;
      border: 2px solid #4a4a4a;
    }
    
    .profile-pic {
      width: 120px;
      height: 120px;
      border-radius: 20px;
      object-fit: cover;
      border: 2px solid #C8C8C891;
      cursor: pointer;
  
    }
  
    .profile-info {
      text-align: center;
    }
    
    .username {
      font-family: 'MinecraftFive-Regular', sans-serif;
      font-size: 24px;
      color: #fff;
      margin-bottom: 5px;
    }
    
    .user-bio {
      font-family: 'minecraft', sans-serif;
      color: #FFFFFF;
      font-size: 14px;
      max-width: 300px;
    }
    
    .stats {
      display: flex;
      gap: 15px;
      margin-top: 10px;
    }
    
    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    
    .stat-label {
      font-family: 'minecraft', sans-serif;
      color: #959595;
      font-size: 12px;
    }
    
    .edit-profile-btn {
      background-color: #2A9A2F;
      border: 2px solid #47C24C;
      box-shadow: 0 2px 0 #009F06;
      color: white;
      padding: 8px 15px;
      font-family: 'MinecraftFive-Regular', sans-serif;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 10px;
    }
    
    .edit-profile-btn:hover {
      background-color: #137517;
    }
    
    .settings-sections {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .settings-card {
      background-color: #262626;
      padding: 15px;
      border-radius: 5px;
      border: 2px solid #4a4a4a;
    }
    
    .card-header {
      font-family: 'MinecraftFive-Regular', sans-serif;
      color: #E0BA31;
      font-size: 18px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .card-content {
      font-family: 'minecraft', sans-serif;
      color: #e0e0e0;
    }
    
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #4a4a4a;
      transition: .4s;
      border-radius: 24px;
    }
    
    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .slider {
      background-color: #2A9A2F;
    }
    
    input:checked + .slider:before {
      transform: translateX(26px);
    }
    
    .setting-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid #3a3a3a;
    }
    
    .setting-item:last-child {
      border-bottom: none;
    }
    
    .setting-label {
      font-family: 'minecraft', sans-serif;
      color: #e0e0e0;
    }
    
    .purchased-items {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }
    
    .item-card {
      background-color: #3a3a3a;
      padding: 10px;
      border-radius: 5px;
      width: 80px;
      height: 80px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    
    .item-icon {
      width: 40px;
      height: 40px;
      object-fit: contain;
    }
    
    .item-name {
      font-family: 'minecraft', sans-serif;
      font-size: 10px;
      color: #e0e0e0;
      text-align: center;
    }
    
    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(5px);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    
    .modal-content {
      background-color: #262626;
      border: 3px solid #E0BA31;
      padding: 20px;
      width: 90%;
      max-width: 500px;
      border-radius: 2px;
      box-shadow: 0px 3px 0px rgba(224, 155, 0, 1);
      animation: fadeIn 0.3s;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .modal-title {
      font-family: 'MinecraftFive-Regular', sans-serif;
      color: #E0BA31;
      font-size: 20px;
    }
    
    .close-modal {
      background: none;
      border: none;
      color: #e0e0e0;
      font-size: 24px;
      cursor: pointer;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-label {
      display: block;
      font-family: 'minecraft', sans-serif;
      color: #e0e0e0;
      margin-bottom: 5px;
    }
    
    .form-input {
      width: 100%;
      padding: 8px;
      background-color: #3a3a3a;
      border: 1px solid #4a4a4a;
      color: #e0e0e0;
      font-family: 'minecraft', sans-serif;
    }
    
    .form-textarea {
      width: 100%;
      height: 100px;
      padding: 8px;
      background-color: #3a3a3a;
      border: 1px solid #4a4a4a;
      color: #e0e0e0;
      font-family: 'minecraft', sans-serif;
      resize: none;
    }
    
    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }
    
    .modal-btn {
      padding: 8px 15px;
      font-family: 'MinecraftFive-Regular', sans-serif;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .modal-btn.cancel {
      background-color: #4a4a4a;
      color: #e0e0e0;
      border: 2px solid #5a5a5a;
    }
    
    .modal-btn.save {
      background-color: #2A9A2F;
      border: 2px solid #47C24C;
      box-shadow: 0 2px 0 #009F06;
      color: white;
    }
    
    .file-input-container {
      position: relative;
      display: inline-block;
      width: 100%;
    }
    
    .file-input {
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    
    .file-input-label {
      display: block;
      padding: 8px;
      background-color: #3a3a3a;
      border: 1px solid #4a4a4a;
      color: #e0e0e0;
      font-family: 'minecraft', sans-serif;
      text-align: center;
      cursor: pointer;
    }
    
    .password-container {
      position: relative;
    }
    
    .toggle-password {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      user-select: none;
      opacity: 0.7;
    }
    
    .toggle-password:hover {
      opacity: 1;
    }
    
    @media (max-width: 600px) {
      .profile-section {
        padding: 15px;
      }
      
      .profile-pic {
        width: 80px;
        height: 80px;
      }
      
      .username {
        font-size: 20px;
      }
      
      .stats {
        flex-wrap: wrap;
        justify-content: center;
      }
    }
    #userPoints{
      text-shadow: 0px 1px 0px #3A2700;
      background: #916204;
      border: 2px solid #A6730F;
      color: #FFD952;
      padding: 2px 10px;
      border-radius: 3px;
      font-size: 17px;
      font-family: MinecraftFive-Regular;
    }
    #userItems{
      text-shadow: 0px 1px 0px #000F3A;
      background: #160491;
      border: 2px solid #220FA6;
      color: #5282FF;
      padding: 2px 10px;
      border-radius: 3px;
      font-size: 17px;
      font-family: MinecraftFive-Regular;
    }
    
/* ÿßŸÑÿ™ÿµŸÖŸäŸÖ ÿßŸÑÿ¨ÿØŸäÿØ ÿ≠ÿ≥ÿ® ÿ∑ŸÑÿ®ŸÉ */
#purchasedItemsContainer {
    display: flex;
flex-wrap: wrap;
gap: 7px;
justify-content: center;
padding: 1px;
margin-top: 30px;
}

.item-card {
    width: auto; /* ÿ≠ÿ¨ŸÖ ŸÖÿ™Ÿàÿ≥ÿ∑ */
    background: #333333; /* ÿ±ŸÖÿßÿØŸä ÿ∫ÿßŸÖŸÇ */
    border-radius: 5px;
    border: none;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    transition: all 0.3s ease;
}


.item-image {
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 10px;
}

.item-image img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
}

.

.item-name {
    color: white; /* ÿ£ÿ®Ÿäÿ∂ */
    font-weight: bold;
    margin-bottom: 5px;
    font-size: 14px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.item-price {
    color: #FFD952;
text-shadow:0px 1px 0px #3A2700;
font-size: auto;
}

.item-warning {
    color: #e74c3c;
    font-size: 12px;
}
.back {
  position: absolute;
  top: 50%;
  left: 15px;
  transform: translateY(-50%);
  z-index: 1001;
}
.sticky-header.sticky {
  position: fixed;
  top: 0;
  animation: fadeIn 0.3s ease-in-out;
}

@keyframes fadeIn {
  from { opacity: 0.9; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
} 
.header {
  background-color: #222222;
  padding: 10px 0;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
  
  /* ÿßÿ≠ÿ™ŸÅÿ∏ ÿ®ÿ®ÿßŸÇŸä ÿÆÿµÿßÿ¶ÿµ ÿßŸÑÿ™ÿµŸÖŸäŸÖ ÿßŸÑÿ≠ÿßŸÑŸäÿ© */
}
     .sticky-header {
  position: sticky;
  top: 0;
  z-index: 1000;
  width: 100%;
  
}
    /* Share Profile Button */
    .share-profile-btn  {
      position: absolute;
      background-color: #3B45B4;
      right: 5%;
      top: 5%;
      display: flex;
  max-width: 20px;
  overflow: hidden;
  cursor:pointer;
  padding: 4px 4px;
  border-radius: 6px;
  border: 2px solid #727EFF;
  gap: 8px;
  text-decoration: none;
  color: white;
  font-family: sans-serif;
  font-weight: bold;
  transition: max-width 0.4s ease, background-color 0.3s;
  font-family: MinecraftFive-Regular;
    }
    
    .share-profile-btn:hover {
      max-width: 150px;
color: #5C86FF;
} 
    .share-profile-btn:hover span{
    color: #A9BAF2;
  opacity: 1;
  transition: all 0.5s ease-out;
font-family: MinecraftFive-Regular;
    }
    .share-profile-btn img{
      width: 20px;
height: 20px;
flex-shrink: 0;
    }
    .share-profile-btn span{
      opacity: 0;
  transition: opacity 0.3s ease;
  white-space: nowrap;
  color: #5A7EFF;
  font-family: MinecraftFive-Regular;
    }
    /* QR Code Container */
    #qrCodeContainer canvas {
      border: 2px solid #C8C8C8;
      border-radius: 5px;
      padding: 5px;
      background: white;
    }
    
    .error-message {
      color: #ff6b6b;
      font-family: 'minecraft';
      font-size: 12px;
      text-align: center;
    }
    .user-handle {
  color: #959595;
  font-size: 14px;
  font-family: 'minecraft', sans-serif;
  margin: 2px 0;
}
    #userFallTokens {
      text-shadow: 0px 1px 0px #000F3A;
      background: #915104;
      border: 2px solid #A6500F;
      color: #FFA752;
      padding: 2px 10px;
      border-radius: 3px;
      font-size: 17px;
      font-family: MinecraftFive-Regular;
    }
        #userLikes {
      text-shadow: 0px 1px 0px #3A0000;
      background: #910404;
      border: 2px solid #A60F0F;
      color: #FF5252;
      padding: 2px 10px;
      border-radius: 3px;
      font-size: 17px;
      font-family: MinecraftFive-Regular;
    }
      /*delete  account btn */
        .delete-account-btn {
      position: absolute;
      background-color: #B43B3B;
      right: 5%;
      top: 5%;
      cursor:pointer;
      align-items: center;
      display: flex;
  max-width: 20px;
  overflow: hidden;
  padding: 3px 12px;
  border-radius: 6px;
  border: 2px solid #FF7272;
  gap: 8px;
  text-decoration: none;
  color: white;
  font-weight: bold;
  transition: max-width 0.4s ease, background-color 0.3s;
  font-family: MinecraftFive-Regular;
    }
    
    .delete-account-btn:hover {
      max-width: 150px;
color: #FF5C5C;
} 
  .delete-account-btn:hover span{
    color: #F2A9A9;
  opacity: 1;
  transition: all 0.5s ease-out;
  font-family: MinecraftFive-Regular;

    }
    .delete-account-btn img{
      width: 20px;
height: 20px;
flex-shrink: 0;
    }
    .delete-account-btn span{
      opacity: 0;
  transition: opacity 0.3s ease;
  white-space: nowrap;
  color: #FF5A5A;
  font-family: MinecraftFive-Regular;
    }
/* ÿ£ŸÜŸÖÿßÿ∑ ÿ¨ÿØŸäÿØÿ© */



.linked-account-photo {
  width: 40px;
  height: 40px;
  border-radius: 5px;
  border: 1px solid #555;
}

.linked-account-details {
  flex: 1;
}

.linked-account-name {
  font-family: 'MinecraftFive-Regular';
  color: #e0e0e0;
  font-size: 16px;
}

.linked-account-email {
  font-family: 'minecraft';
  color: #959595;
  font-size: 12px;
}

/* ÿ™ÿπÿØŸäŸÑ ÿ£ŸÜŸÖÿßÿ∑ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± */
#googleAuthBtn {
  background-color: #2A9A2F;
  border: 2px solid #47C24C;
  color: white;
  padding: 4px 5px;
  font-family: 'MinecraftFive-Regular';
  cursor: pointer;
  transition: all 0.3s;
}

#googleAuthBtn:hover {
  background-color: #137517;
}


.google-link-desc {
  font-family: 'minecraft';
  font-size: 13px;
  color: #ccc;
}
#googleUnlinkBtn{
  background-color: #C42A2A;
  border: 2px solid #F15555;
  padding: 4px 5px;
}
#googleUnlinkBtn:hover{
  background-color: #891A1A;
}
#googleAuthBtn.google-linked {
  background-color: #4a4a4a;
  border-color: #5a5a5a;
  cursor: default;
}

#googleAuthBtn.google-linked:hover {
  background-color: #4a4a4a;
}
/* ÿ£ŸÜŸÖÿßÿ∑ ÿ¨ÿØŸäÿØÿ© */



.linked-account-photo {
  width: 40px;
  height: 40px;
  border-radius: 5px;
  border: 1px solid #555;
}

.linked-account-details {
  flex: 1;
}

.linked-account-name {
  font-family: 'MinecraftFive-Regular';
  color: #e0e0e0;
  font-size: 16px;
}

.linked-account-email {
  font-family: 'minecraft';
  color: #959595;
  font-size: 12px;
}

/* ÿ™ÿπÿØŸäŸÑ ÿ£ŸÜŸÖÿßÿ∑ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± */
#googleAuthBtn {
  background-color: #2A9A2F;
  border: 2px solid #47C24C;
  color: white;
  padding: 4px 5px;
  font-family: 'MinecraftFive-Regular';
  cursor: pointer;
  transition: all 0.3s;
}

#googleAuthBtn:hover {
  background-color: #137517;
}


.google-link-desc {
  font-family: 'minecraft';
  font-size: 13px;
  color: #ccc;
}
#googleUnlinkBtn{
  background-color: #C42A2A;
  border: 2px solid #F15555;
  padding: 4px 5px;
}
#googleUnlinkBtn:hover{
  background-color: #891A1A;
}
#googleAuthBtn.google-linked {
  background-color: #4a4a4a;
  border-color: #5a5a5a;
  cursor: default;
}

#googleAuthBtn.google-linked:hover {
  background-color: #4a4a4a;
}
  </style>
</head>
<body>
  <div class="sticky-header"> 
  <div class="header">
    <button class="back" id="backButton" type="button" onclick="goBack()"></button>
  Settings <img src="../icons/Setting_icon.png" height="24">
  </div>
  </div>
  <div class="content">
    <div class="settings-container">
      <!-- Profile Section -->
      
      <div class="profile-section">
        <img src="../icons/player-head-128-052ba.png" class="profile-pic" id="profilePic">
        <div class="profile-info">
          <div class="username" id="usernameDisplay">Loading...</div>
  <div class="user-handle" id="userHandle">@username</div> 
  <div class="user-bio" id="userBio"></div>
</div>
        <div class="stats">
          <div class="stat-item">
            <div class="stat-value" id="userPoints">0</div>
            <div class="stat-label">Coins</div>
          </div>
                    <div class="stat-item">
            <div class="stat-value" id="userFallTokens">0</div>
            <div class="stat-label">Fall Tokens</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="userItems">0</div>
            <div class="stat-label">Items</div>
          </div>
        <div class="stat-item">
          <div class="stat-value" id="userLikes">0</div>
          <div class="stat-label">Likes</div>
        </div>
      
        </div>
        <button class="edit-profile-btn" id="editProfileBtn">Edit Profile</button>
      <div class="share-profile-btn" id="shareProfileBtn"> 
         <img  src="../icons/Share_logo.png">
         <span>Share</span>
        </div> 
      </div>
      
      <!-- Settings Sections -->
      <div class="settings-sections">
        <!-- Account Settings -->
        <div class="settings-card">
          <div class="card-header">‚öôÔ∏è Dev.Account Settings</div>
          <div class="card-content">
            <div class="setting-item">
              <span class="setting-label">Dark Mode</span>
              <label class="toggle-switch">
                <input type="checkbox" id="darkModeToggle" checked>
                <span class="slider"></span>
                
              </label>
            </div>
            <div class="setting-item">
              <span class="setting-label">Notifications</span>
              <label class="toggle-switch">
                <input type="checkbox" id="notificationsToggle" checked>
                <span class="slider"></span>
              </label>
            </div>
                   <div class="setting-item">
         <span class="setting-label">Change Password</span>
         <button class="modal-btn" id="changePasswordBtn" style="padding: 4px 8px;">Change</button>
       </div>
       <div class="setting-item">
         <span class="setting-label">Change Email</span>
         <button class="modal-btn" id="changeEmailBtn" style="padding: 4px 8px;">Change</button>
       </div>
          </div>
        </div><!-- ÿØÿßÿÆŸÑ ŸÇÿ≥ŸÖ Account Settings -->
<div class="settings-card">
  <div class="card-header">üîó Linked Accounts</div>
  <div class="card-content" style="display: flex; justify-content: space-between; align-items: center;">
    <img id="googleProfileImage" src="../icons/player-head-128-052ba.png" style="width: 32px; height: 32px; border-radius: 50%; display: none;" />
    <div class="google-link-desc" id="googleLinkDescription">
      Linking your account to Google
    </div>
    <div class="google-actions" style="display: flex; gap: 8px;">
      <button class="modal-btn" id="googleAuthBtn">Link</button>
      <button class="modal-btn" id="googleUnlinkBtn" style="display: none;">Unlink</button>
    </div>
  </div>
</div>

        
        <!-- Purchased Items -->
        <div class="settings-card">
          <div class="card-header">üõí Dev.Purchased Items</div>
          <div class="card-content">
            <div id="noItemsMessage" style="display: none;">You haven't purchased any items yet.</div>
            <div class="purchased-items" id="purchasedItemsContainer">
              <!-- Items will be added here dynamically -->
            </div>
          </div>
        </div>
        
        <!-- Account Actions -->
        <div class="settings-card">
          <div class="card-header">‚ö†Ô∏è Dev.Account Actions</div>
          <div class="card-content">
     
            <div class="setting-item">
              <span class="setting-label">Delete Account</span>
              <div class="delete-account-btn" id="deleteAccountBtn"> 
              <img srcset="" src="../icons/trash.png" alt="">
              <span>Delete</span>
              </div> 
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Edit Profile Modal -->
  <div class="modal" id="editProfileModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Edit Profile</div>
        <button class="close-modal" id="closeEditModal">&times;</button>
      </div>
      <div class="form-group">
        <label class="form-label">Profile Picture</label>
        <div class="file-input-container">
          <input type="file" id="profilePicInput" class="file-input" accept="image/*">
          
          <label for="profilePicInput" class="file-input-label">Choose Image</label>
        </div>
        <div id="selectedFileName" style="font-family: 'minecraft'; color: #959595; font-size: 12px; margin-top: 5px;"></div>
      </div>
      <div class="form-group">
        <label class="form-label">Username</label>
        <p style="color: wheat;">you canalsouse icons in your username.</p>
        <input type="text" id="editUsername" class="form-input" maxlength="20">
      </div>
      <div class="form-group">
        <label class="form-label">Bio</label>
        <textarea id="editBio" class="form-textarea" maxlength="150"></textarea>
      </div>
      <div class="modal-actions">
        <button class="modal-btn cancel" id="cancelEditBtn">Cancel</button>
        <button class="modal-btn save" id="saveProfileBtn">Save Changes</button>
      </div>
    </div>
  </div>
  
  <!-- Change Password Modal -->
  <div class="modal" id="changePasswordModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Change Password</div>
        <button class="close-modal" id="closePasswordModal">&times;</button>
      </div>
      <div class="form-group">
        <label class="form-label">Current Password</label>
        <div class="password-container">
          <input type="password" id="currentPassword" class="form-input">
          <span class="toggle-password" onclick="togglePasswordVisibility('currentPassword')">üëÅÔ∏è</span>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">New Password</label>
        <div class="password-container">
          <input type="password" id="newPassword" class="form-input">
          <span class="toggle-password" onclick="togglePasswordVisibility('newPassword')">üëÅÔ∏è</span>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Confirm New Password</label>
        <div class="password-container">
          <input type="password" id="confirmPassword" class="form-input">
          <span class="toggle-password" onclick="togglePasswordVisibility('confirmPassword')">üëÅÔ∏è</span>
        </div>
      </div>
      <div class="modal-actions">
        <button class="modal-btn cancel" id="cancelPasswordBtn">Cancel</button>
        <button class="modal-btn save" id="savePasswordBtn">Change Password</button>
      </div>
    </div>
  </div>
  
  <!-- Change Email Modal -->
  <div class="modal" id="changeEmailModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Change Email</div>
        <button class="close-modal" id="closeEmailModal">&times;</button>
      </div>
      <div class="form-group">
        <label class="form-label">Current Email</label>
        <input type="email" id="currentEmail" class="form-input" disabled>
      </div>
      <div class="form-group">
        <label class="form-label">New Email</label>
        <input type="email" id="newEmail" class="form-input">
      </div>
      <div class="form-group">
        <label class="form-label">Confirm New Email</label>
        <input type="email" id="confirmEmail" class="form-input">
      </div>
      <div class="form-group">
        <label class="form-label">Current Password</label>
        <div class="password-container">
          <input type="password" id="emailCurrentPassword" class="form-input">
          <span class="toggle-password" onclick="togglePasswordVisibility('emailCurrentPassword')">üëÅÔ∏è</span>
        </div>
      </div>
      <div class="modal-actions">
        <button class="modal-btn cancel" id="cancelEmailBtn">Cancel</button>
        <button class="modal-btn save" id="saveEmailBtn">Change Email</button>
      </div>
    </div>
  </div>
  
  <!-- Delete Account Modal -->
  <div class="modal" id="deleteAccountModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">‚ö†Ô∏è Delete Account</div>
        <button class="close-modal" id="closeDeleteModal">&times;</button>
      </div>
      <div class="card-content">
        <p style="font-family: 'minecraft'; color: #e0e0e0; margin-bottom: 15px;">
          Are you sure you want to delete your account? This action cannot be undone. All your data will be permanently removed.
        </p>
        <div class="form-group">
          <label class="form-label">Enter your password to confirm</label>
          <div class="password-container">
            <input type="password" id="deleteAccountPassword" class="form-input">
            <span class="toggle-password" onclick="togglePasswordVisibility('deleteAccountPassword')">üëÅÔ∏è</span>
          </div>
        </div>
      </div>
      <div class="modal-actions">
        <button class="modal-btn cancel" id="cancelDeleteBtn">Cancel</button>
        <button class="modal-btn" style="background-color: #d32f2f; border: 2px solid #f44336;" id="confirmDeleteBtn">Delete Account</button>
      </div>
    </div>
  </div>
  <!-- Share Profile Modal -->
  <div class="modal" id="shareProfileModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">Share Your Profile</div>
        <button class="close-modal" id="closeShareModal">&times;</button>
      </div>
      <div class="card-content">
        <div style="text-align: center; margin-bottom: 20px;">
          <div id="qrCodeContainer" style="margin: 0 auto; width: 150px; height: 150px;"></div>
          <div id="qrCodeError" class="error-message" style="display: none;"></div>
        </div>
        <div class="form-group">
          <label class="form-label">Profile Link</label>
          <div style="display: flex; gap: 5px;">
            <input type="text" id="profileLink" class="form-input" readonly>
            <button class="modal-btn" id="copyLinkBtn" style="padding: 8px 12px;">Copy</button>
          </div>
        </div>
        <div style="font-family: 'minecraft'; color: #959595; font-size: 12px; margin-top: 10px; text-align: center;">
          Share this link or QR code to let others view your profile
        </div>
      </div>
      <div class="modal-actions">
        <button class="modal-btn cancel" id="closeShareModalBtn">Close</button>
      </div>
    </div>
  </div>
<script>
  // ÿØÿßŸÑÿ© ŸÖÿ®ÿ≥ÿ∑ÿ© ŸÑÿ≠ŸÅÿ∏ Ÿàÿßÿ≥ÿ™ÿ±ÿ¨ÿßÿπ ÿßŸÑÿµŸàÿ± ÿ®ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑÿ±ÿßÿ®ÿ∑ ŸÉŸÖŸÅÿ™ÿßÿ≠
  function cacheImages() {
    // ÿ™ÿ≠ÿØŸäÿØ ÿ¨ŸÖŸäÿπ ÿßŸÑÿµŸàÿ± ŸÅŸä ÿßŸÑÿµŸÅÿ≠ÿ©
    const images = document.querySelectorAll('img, [style*="background-image"]');
    
    images.forEach(element => {
      let imageUrl;
      
      // ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿµŸàÿ±ÿ© ÿ≥Ÿàÿßÿ° ŸÖŸÜ src ÿ£Ÿà ŸÖŸÜ background-image
      if (element.tagName === 'IMG') {
        imageUrl = element.src;
      } else {
        const style = window.getComputedStyle(element);
        imageUrl = style.backgroundImage.replace(/url\(['"]?(.*?)['"]?\)/i, '$1');
      }
      
      // ÿ™ÿÆÿ∑Ÿä ÿßŸÑÿ±Ÿàÿßÿ®ÿ∑ ÿßŸÑŸÅÿßÿ±ÿ∫ÿ© ÿ£Ÿà ÿ±Ÿàÿßÿ®ÿ∑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ (data URLs)
      if (!imageUrl || imageUrl.startsWith('data:')) return;
      
      // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÖÿß ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑÿµŸàÿ±ÿ© ŸÖÿÆÿ≤ŸÜÿ© ŸÖÿ≥ÿ®ŸÇÿßŸã
      const cachedImage = localStorage.getItem(imageUrl);
      
      if (cachedImage) {
        // ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑÿµŸàÿ±ÿ© ŸÖÿÆÿ≤ŸÜÿ©ÿå ŸÜÿ≥ÿ™ÿÆÿØŸÖŸáÿß ŸÖÿ®ÿßÿ¥ÿ±ÿ©
        if (element.tagName === 'IMG') {
          element.src = cachedImage;
        } else {
          element.style.backgroundImage = `url(${cachedImage})`;
        }
      } else {
        // ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ŸÉŸÜ ŸÖÿÆÿ≤ŸÜÿ©ÿå ŸÜÿ≠ŸÖŸÑŸáÿß ŸàŸÜÿÆÿ≤ŸÜŸáÿß
        fetch(imageUrl)
          .then(response => response.blob())
          .then(blob => {
            const reader = new FileReader();
            reader.onload = function() {
              localStorage.setItem(imageUrl, this.result);
              if (element.tagName === 'IMG') {
                element.src = this.result;
              } else {
                element.style.backgroundImage = `url(${this.result})`;
              }
            };
            reader.readAsDataURL(blob);
          })
          .catch(error => {
            console.error('Error caching image:', error);
          });
      }
    });
  }
  
  // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿØÿßŸÑÿ© ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
  window.addEventListener('DOMContentLoaded', cacheImages);
</script>
<script type="module">
    import { db, auth } from '../scripts/main.js';
    import { 
      doc, 
      getDoc, 
      setDoc,
      updateDoc,
      deleteDoc,
      collection,
      query,
      where,
      getDocs,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
    import { shopItems } from './items.js';
    import {
      GoogleAuthProvider,
      signInWithPopup,
      signInAnonymously,
      onAuthStateChanged,
      signOut,
      updatePassword,
      updateEmail,
      reauthenticateWithCredential,
      EmailAuthProvider,
      deleteUser
    } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
    
    // Get current user data
    const user = auth.currentUser;
    let currentUserData = {};
    
    function formatNumber(num) {
        if (num >= 1e12) return (num / 1e12).toFixed(1) + 'T';
        if (num >= 1e9) return (num / 1e9).toFixed(1) + 'B';
        if (num >= 1e6) return (num / 1e6).toFixed(1) + 'M';
        if (num >= 1e3) return (num / 1e3).toFixed(1) + 'K';
        return num.toString();
    }

    // Load user data from localStorage or Firestore
    async function loadUserData() {
      try {
        const userId = localStorage.getItem("activeUser");
        if (!userId) {
          console.warn("No user logged in");
          window.location.href = "login.html";
          return;
        }
        
        const userDocRef = doc(db, 'users', userId);
        const userDoc = await getDoc(userDocRef);
        
        if (!userDoc.exists()) {
          throw new Error("User document not found");
        }
        
        currentUserData = userDoc.data();
        displayUserData(currentUserData);
        
        // Display purchased items
        const purchasedItems = currentUserData.purchasedItems || [];
        if (purchasedItems.length > 0) {
          displayPurchasedItems(purchasedItems);
        } else {
          document.getElementById('noItemsMessage').style.display = 'block';
        }
        
      } catch (error) {
        console.error("Error details:", {
          message: error.message,
          stack: error.stack,
          name: error.name
        });
        alert("‚ö†Ô∏è Error loading data. Please try again later.");
      }
    }
    
    // Display user data in the UI
    function displayUserData(userData) {
      const userId = localStorage.getItem("activeUser");
      
      document.getElementById('usernameDisplay').textContent = userData.displayName || userData.username || "User";
      document.getElementById('userHandle').textContent = "@" + userId;
      document.getElementById('userBio').textContent = userData.bio || "No bio yet";
      document.getElementById('userPoints').textContent = userData.points || 0;
      document.getElementById('userFallTokens').textContent = formatNumber(userData.fallTokens || 0);
      document.getElementById('userLikes').textContent = formatNumber(userData.likes || 0);
      // Set profile picture if available
      if (userData.photoURL) {
        document.getElementById('profilePic').src = userData.photoURL;
      }
      
      // Set member since year
      if (userData.createdAt) {
        const date = userData.createdAt.toDate();
        document.getElementById('userSince').textContent = date.getFullYear();
      }
      
      // Set purchased items count
      if (userData.purchasedItems) {
        document.getElementById('userItems').textContent = userData.purchasedItems.length;
      }
      
      // Set current email if available
      if (userData.email) {
        document.getElementById('currentEmail').value = userData.email;
      }
    }

    // Display purchased items
    function displayPurchasedItems(purchasedItemNames) {
      const container = document.getElementById('purchasedItemsContainer');
      container.innerHTML = '';
      
      if (!purchasedItemNames || purchasedItemNames.length === 0) {
        document.getElementById('noItemsMessage').style.display = 'block';
        return;
      }
      
      purchasedItemNames.forEach(itemName => {
        const itemData = shopItems.find(item =>
          item.name.trim().toLowerCase() === itemName.trim().toLowerCase()
        );
        
        const itemCard = document.createElement('div');
        itemCard.className = 'item-card';
        
        if (itemData) {
          itemCard.innerHTML = `
            <div class="item-image">
                <img src="${itemData.imageUrl}" alt="${itemData.name}"
                     onerror="this.src='../icons/default_item.png'">
            </div>
            <div class="item-info">
                <div class="item-name">${itemData.name}</div>
                <div class="item-price">${formatNumber(itemData.price)}<img src="../icons/coinss_gif.gif"loading="lazy" height="15"></div>
            </div>
          `;
        } else {
          itemCard.innerHTML = `
            <div class="item-image">
                <img src="../icons/default_item.png" alt="${itemName}">
            </div>
            <div class="item-info">
                <div class="item-name">${itemName}</div>
                <div class="item-warning"> Not available</div>
            </div>
          `;
        }
        
        container.appendChild(itemCard);
      });
    }
    
    // Modal toggle functions
    function toggleModal(modalId, show) {
      const modal = document.getElementById(modalId);
      modal.style.display = show ? 'flex' : 'none';
    }
    
    // Event listeners for modals
    document.getElementById('editProfileBtn').addEventListener('click', () => {
      document.getElementById('editUsername').value = currentUserData.displayName || currentUserData.username || "";
      document.getElementById('editBio').value = currentUserData.bio || "";
      toggleModal('editProfileModal', true);
    });
    
    document.getElementById('changePasswordBtn').addEventListener('click', () => {
      toggleModal('changePasswordModal', true);
    });
    
    document.getElementById('changeEmailBtn').addEventListener('click', () => {
      toggleModal('changeEmailModal', true);
    });
    
    document.getElementById('deleteAccountBtn').addEventListener('click', () => {
      toggleModal('deleteAccountModal', true);
    });
    
    // Close modals
    document.getElementById('closeEditModal').addEventListener('click', () => toggleModal('editProfileModal', false));
    document.getElementById('closePasswordModal').addEventListener('click', () => toggleModal('changePasswordModal', false));
    document.getElementById('closeEmailModal').addEventListener('click', () => toggleModal('changeEmailModal', false));
    document.getElementById('closeDeleteModal').addEventListener('click', () => toggleModal('deleteAccountModal', false));
    document.getElementById('cancelEditBtn').addEventListener('click', () => toggleModal('editProfileModal', false));
    document.getElementById('cancelPasswordBtn').addEventListener('click', () => toggleModal('changePasswordModal', false));
    document.getElementById('cancelEmailBtn').addEventListener('click', () => toggleModal('changeEmailModal', false));
    document.getElementById('cancelDeleteBtn').addEventListener('click', () => toggleModal('deleteAccountModal', false));
    
    // Profile picture upload
    document.getElementById('profilePicInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        document.getElementById('selectedFileName').textContent = `Selected: ${file.name}`;
        
        // Preview the image
        const reader = new FileReader();
        reader.onload = function(event) {
          document.getElementById('profilePic').src = event.target.result;
        };
        reader.readAsDataURL(file);
      }
    });
    
    // Save profile changes
    document.getElementById('saveProfileBtn').addEventListener('click', async () => {
      const newUsername = document.getElementById('editUsername').value.trim();
      const newBio = document.getElementById('editBio').value.trim();
      const fileInput = document.getElementById('profilePicInput');
      
      if (!newUsername) {
        alert('üö´ Username cannot be empty');
        return;
      }
      
      try {
        const userId = localStorage.getItem("activeUser");
        const userDocRef = doc(db, 'users', userId);
        
        const updateData = {
          displayName: newUsername,
          bio: newBio,
          updatedAt: serverTimestamp()
        };
        
        // Handle profile picture upload
        if (fileInput.files.length > 0) {
          const file = fileInput.files[0];
          const reader = new FileReader();
          reader.onload = async function(event) {
            updateData.photoURL = event.target.result;
            await updateDoc(userDocRef, updateData);
            currentUserData = { ...currentUserData, ...updateData };
            displayUserData(currentUserData);
            toggleModal('editProfileModal', false);
            alert('‚úÖ Profile updated successfully!');
          };
          reader.readAsDataURL(file);
        } else {
          await updateDoc(userDocRef, updateData);
          currentUserData = { ...currentUserData, ...updateData };
          displayUserData(currentUserData);
          toggleModal('editProfileModal', false);
          alert('‚úÖ Profile updated successfully!');
        }
      } catch (error) {
        console.error("Error updating profile:", error);
        alert("‚ö†Ô∏è Failed to update profile. Please try again.");
      }
    });
    
    // Change password
    document.getElementById('savePasswordBtn').addEventListener('click', async () => {
      const currentPassword = document.getElementById('currentPassword').value;
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      
      if (!currentPassword || !newPassword || !confirmPassword) {
        alert('üö´ Please fill all fields');
        return;
      }
      
      if (newPassword !== confirmPassword) {
        alert('üîí New passwords do not match');
        return;
      }
      
      if (newPassword.length < 6) {
        alert('üîê Password must be at least 6 characters');
        return;
      }
      
      try {
        const userId = localStorage.getItem("activeUser");
        const userDocRef = doc(db, 'users', userId);
        const userDoc = await getDoc(userDocRef);
        
        if (!userDoc.exists()) {
          alert('üë§ User not found');
          return;
        }
        
        const userData = userDoc.data();
        if (userData.password !== currentPassword) {
          alert('‚ùå Current password is incorrect');
          return;
        }
        
        await updateDoc(userDocRef, { password: newPassword });
        
        alert('üîë Password changed successfully!');
        toggleModal('changePasswordModal', false);
      } catch (error) {
        console.error("Error changing password:", error);
        alert("‚ö†Ô∏è Failed to change password. Please try again.");
      }
    });
    
    // Change email
    document.getElementById('saveEmailBtn').addEventListener('click', async () => {
      const newEmail = document.getElementById('newEmail').value.trim();
      const confirmEmail = document.getElementById('confirmEmail').value.trim();
      const currentPassword = document.getElementById('emailCurrentPassword').value;
      
      if (!newEmail || !confirmEmail || !currentPassword) {
        alert('üö´ Please fill all fields');
        return;
      }
      
      if (newEmail !== confirmEmail) {
        alert('üìß Emails do not match');
        return;
      }
      
      try {
        const userId = localStorage.getItem("activeUser");
        const userDocRef = doc(db, 'users', userId);
        const userDoc = await getDoc(userDocRef);
        
        if (!userDoc.exists()) {
          alert('üë§ User not found');
          return;
        }
        
        const userData = userDoc.data();
        if (userData.password !== currentPassword) {
          alert('‚ùå Current password is incorrect');
          return;
        }
        
        await updateDoc(userDocRef, { email: newEmail });
        
        alert('üìß Email changed successfully!');
        toggleModal('changeEmailModal', false);
        document.getElementById('currentEmail').value = newEmail;
      } catch (error) {
        console.error("Error changing email:", error);
        alert("‚ö†Ô∏è Failed to change email. Please try again.");
      }
    });
    
    // Delete account
    document.getElementById('confirmDeleteBtn').addEventListener('click', async () => {
      const password = document.getElementById('deleteAccountPassword').value;
      
      if (!password) {
        alert('üö´ Please enter your password');
        return;
      }
      
      if (!confirm('‚ùó‚ùó Are you absolutely sure you want to delete your account? This cannot be undone.')) {
        return;
      }
      
      try {
        const userId = localStorage.getItem("activeUser");
        const userDocRef = doc(db, 'users', userId);
        const userDoc = await getDoc(userDocRef);
        
        if (!userDoc.exists()) {
          alert('üë§ User not found');
          return;
        }
        
        const userData = userDoc.data();
        if (userData.password !== password) {
          alert('‚ùå Password is incorrect');
          return;
        }
        
        await deleteDoc(userDocRef);
        
        localStorage.removeItem("activeUser");
        
        alert('üóëÔ∏è Account deleted successfully. You will be redirected to the home page.');
        window.location.href = "login.html";
      } catch (error) {
        console.error("Error deleting account:", error);
        alert("‚ö†Ô∏è Failed to delete account. Please try again.");
      }
    });
    
    // Dark mode toggle
    document.getElementById('darkModeToggle').addEventListener('change', function() {
      document.body.classList.toggle('dark-mode', this.checked);
      localStorage.setItem('darkMode', this.checked);
    });
    
    // Check for saved dark mode preference
    if (localStorage.getItem('darkMode') === 'true') {
      document.getElementById('darkModeToggle').checked = true;
      document.body.classList.add('dark-mode');
    }
    
    // Password visibility toggle
    window.togglePasswordVisibility = function(inputId) {
      const input = document.getElementById(inputId);
      const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
      input.setAttribute('type', type);
      
      const eyeIcon = input.nextElementSibling.querySelector('i');
      if (eyeIcon) {
        eyeIcon.classList.toggle('fa-eye');
        eyeIcon.classList.toggle('fa-eye-slash');
      }
    };
    
    // Initialize the page - load user data first
    document.addEventListener('DOMContentLoaded', () => {
      loadUserData();
    });
// Google Account Linking System
document.addEventListener('DOMContentLoaded', () => {
  const googleAuthBtn = document.getElementById('googleAuthBtn');
  const googleAuthText = document.getElementById('googleAuthText');
  const googleAccountInfo = document.getElementById('googleAccountInfo');
  const googleAccountPhoto = document.getElementById('googleAccountPhoto');
  const googleAccountName = document.getElementById('googleAccountName');
  const googleAccountEmail = document.getElementById('googleAccountEmail');
  
  // ÿπÿ±ÿ∂ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿ≠ÿ≥ÿßÿ® ÿ¨Ÿàÿ¨ŸÑ ÿßŸÑŸÖÿ±ÿ®Ÿàÿ∑
function displayGoogleAccountInfo(userData) {
  const description = document.getElementById('googleLinkDescription');
  const authBtn = document.getElementById('googleAuthBtn');
  const unlinkBtn = document.getElementById('googleUnlinkBtn');
  
  // üü¢ ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿ£ŸàŸÑŸâ: ÿ±ÿ®ÿ∑ ŸÖŸÉÿ™ŸÖŸÑ
  if (userData.provider === "google" && userData.googleAccount) {
    const { displayName, email } = userData.googleAccount;
    description.textContent = `${displayName} (${email})`;
    
    authBtn.textContent = 'Linked';
    authBtn.classList.add('google-linked');
    authBtn.disabled = true;
    unlinkBtn.style.display = 'inline-block';
    
    // üü° ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿ´ÿßŸÜŸäÿ©: ŸäŸàÿ¨ÿØ "google" ŸàŸÑŸÉŸÜ ŸÑÿß ŸäŸàÿ¨ÿØ googleAccount ‚Üí ÿ™ŸàŸÑŸäÿØ ÿ®ŸäÿßŸÜÿßÿ™
  } else if (userData.provider === "google" && !userData.googleAccount && userData.email) {
    description.textContent = `(Linked via Google: ${userData.email})`;
    
    authBtn.textContent = 'Linked';
    authBtn.classList.add('google-linked');
    authBtn.disabled = true;
    unlinkBtn.style.display = 'inline-block';
    
    // ÿ≠ŸÅÿ∏ ÿ®ŸäÿßŸÜÿßÿ™ googleAccount ŸÖŸÅŸÇŸàÿØÿ©
    const fallbackGoogleAccount = {
      displayName: userData.displayName || "Google User",
      email: userData.email,
      photoURL: userData.photoURL || "../icons/player-head-128-052ba.png"
    };
    
    // ÿ™ÿ≠ÿØŸäÿ´ Firestore ŸÅŸÇÿ∑ ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ŸÉŸÜ ŸÖŸàÿ¨ŸàÿØÿ© ŸÖÿ≥ÿ®ŸÇŸãÿß
    const userId = localStorage.getItem("activeUser");
    const userDocRef = doc(db, 'users', userId);
    updateDoc(userDocRef, {
      googleAccount: fallbackGoogleAccount,
      updatedAt: serverTimestamp()
    }).then(() => {
      console.log("‚úÖ ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ googleAccount ÿ™ŸÑŸÇÿßÿ¶ŸäŸãÿß");
    }).catch(err => {
      console.warn("‚ö†Ô∏è ŸÅÿ¥ŸÑ ÿ≠ŸÅÿ∏ googleAccount ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä:", err.message);
    });
    
    // üî¥ ŸÑÿß ŸäŸàÿ¨ÿØ ÿ±ÿ®ÿ∑
  } else {
    description.textContent = 'Linking your account to Google';
    authBtn.textContent = 'Link';
    authBtn.classList.remove('google-linked');
    authBtn.disabled = false;
    unlinkBtn.style.display = 'none';
  }
}
  
  // ÿπÿ±ÿ∂ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ™ÿ£ŸÉŸäÿØ ÿßŸÑŸÖÿÆÿµÿµÿ©
  async function showConfirmationModal(title, message, confirmText, cancelText) {
    return new Promise((resolve) => {
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.style.display = 'flex';
      modal.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">
            <div class="modal-title">${title}</div>
            <button class="close-modal" id="closeModal">&times;</button>
          </div>
          <div class="card-content">
            <p style="font-family: 'minecraft'; color: #e0e0e0;">${message}</p>
          </div>
          <div class="modal-actions">
            <button class="modal-btn cancel" id="cancelBtn">${cancelText}</button>
            <button class="modal-btn save" id="confirmBtn">${confirmText}</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      document.getElementById('confirmBtn').addEventListener('click', () => {
        document.body.removeChild(modal);
        resolve(true);
      });
      
      document.getElementById('cancelBtn').addEventListener('click', () => {
        document.body.removeChild(modal);
        resolve(false);
      });
      
      document.getElementById('closeModal').addEventListener('click', () => {
        document.body.removeChild(modal);
        resolve(false);
      });
    });
  }
  
  // ÿ±ÿ®ÿ∑ ÿ≠ÿ≥ÿßÿ® ÿ¨Ÿàÿ¨ŸÑ
  async function linkGoogleAccount() {
    const userId = localStorage.getItem("activeUser");
    const userDocRef = doc(db, 'users', userId);
    
    try {
      const provider = new GoogleAuthProvider();
      provider.setCustomParameters({ prompt: 'select_account' });
      
      const result = await signInWithPopup(auth, provider);
      const googleUser = result.user;
      
      const confirm = await showConfirmationModal(
        'Link Google Account',
        `Do you want to link your account with ${googleUser.email}?`,
        'Confirm Link',
        'Cancel'
      );
      
      if (!confirm) return;
      
      await updateDoc(userDocRef, {
        provider: "google",
        googleAccount: {
          displayName: googleUser.displayName,
          email: googleUser.email,
          photoURL: googleUser.photoURL
        },
        updatedAt: serverTimestamp()
      });
      
      loadUserData();
      alert('‚úÖ Google account linked successfully!');
      
    } catch (error) {
      console.error("Google link error:", error);
      alert('Failed to link Google account: ' + error.message);
    }
  }
  
  // ŸÅŸÉ ÿ±ÿ®ÿ∑ ÿ≠ÿ≥ÿßÿ® ÿ¨Ÿàÿ¨ŸÑ
  async function unlinkGoogleAccount() {
    const confirm = await showConfirmationModal(
      'Unlink Google Account',
      'Are you sure you want to unlink your Google account?',
      'Confirm Unlink',
      'Cancel'
    );
    
    if (!confirm) return;
    
    const userId = localStorage.getItem("activeUser");
    const userDocRef = doc(db, 'users', userId);
    
    try {
      await updateDoc(userDocRef, {
        provider: "email",
        googleAccount: null,
        updatedAt: serverTimestamp()
      });
      
      loadUserData();
      alert('Google account unlinked successfully');
      
    } catch (error) {
      console.error("Unlink error:", error);
      alert('Failed to unlink Google account');
    }
  }
  
  // ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÜŸÇÿ± ÿπŸÑŸâ ÿ≤ÿ± ÿ¨Ÿàÿ¨ŸÑ
googleAuthBtn.addEventListener('click', async () => {
  await linkGoogleAccount();
});

googleUnlinkBtn.addEventListener('click', async () => {
  await unlinkGoogleAccount();
});
  
  // ÿ™ÿ≠ÿØŸäÿ´ Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
  function loadUserData() {
    const userId = localStorage.getItem("activeUser");
    if (!userId) return;
    
    const userDocRef = doc(db, 'users', userId);
    getDoc(userDocRef).then(userDoc => {
      if (userDoc.exists()) {
        displayGoogleAccountInfo(userDoc.data());
      }
    });
  }

  // ÿßŸÑÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ£ŸàŸÑŸäÿ©
  loadUserData();
});

</script>
<script>
  // ÿØÿßŸÑÿ© ÿ±ÿ¶Ÿäÿ≥Ÿäÿ© ŸÑÿ™ÿ≠ÿØŸäÿ´ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ™ÿπÿ±ŸäŸÅ
  async function updateMetaTags() {
    const userId = getCurrentUserId(); // ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ID ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ≠ÿßŸÑŸä
    
    if (!userId) return;
    
    try {
      const userDoc = await getDoc(doc(db, "users", userId));
      if (!userDoc.exists()) return;
      
      const userData = userDoc.data();
      const currentUrl = window.location.href.split('?')[0] + `?user=${userId}`;
      
      // ÿ•ŸÜÿ¥ÿßÿ° ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿµŸàÿ±ÿ© ŸÖÿπ token ÿßŸÑŸàÿµŸàŸÑ
      const imageUrl = await getAccessibleImageUrl(userData.photoURL);
      
      // ÿ™ÿ≠ÿØŸäÿ´ Ÿàÿ≥ŸàŸÖ ÿßŸÑÿ™ÿπÿ±ŸäŸÅ
      updateTag('og:url', currentUrl);
      updateTag('og:title', `${userData.displayName || userId}'s MC Profile`);
      updateTag('og:description', userData.bio || "Minecraft Player Profile");
      updateTag('og:image', imageUrl);
      updateTag('profile:username', userId);
      
      // ÿ™ÿ≠ÿØŸäÿ´ ÿπŸÜŸàÿßŸÜ ÿßŸÑÿµŸÅÿ≠ÿ©
      document.title = `${userData.displayName || userId}'s Profile`;
      
    } catch (error) {
      console.error("Error updating meta tags:", error);
    }
  }
  
  // ÿØÿßŸÑÿ© ŸÖÿ≥ÿßÿπÿØÿ© ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿ±ÿßÿ®ÿ∑ ÿµŸàÿ±ÿ© ŸÖÿ™ÿßÿ≠
  async function getAccessibleImageUrl(photoURL) {
    if (!photoURL) return 'https://example.com/default_profile.jpg';
    
    // ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ÿßŸÑÿµŸàÿ±ÿ© ŸÅŸä Firebase Storage
    if (photoURL.startsWith('gs://')) {
      const storageRef = ref(storage, photoURL);
      return getDownloadURL(storageRef);
    }
    
    return photoURL;
  }
  
  // ÿØÿßŸÑÿ© ŸÖÿ≥ÿßÿπÿØÿ© ŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸàÿ≥ŸàŸÖ
  function updateTag(property, content) {
    let tag = document.querySelector(`meta[property="${property}"]`);
    if (!tag) {
      tag = document.createElement('meta');
      tag.setAttribute('property', property);
      document.head.appendChild(tag);
    }
    tag.setAttribute('content', content);
  }
  
  // ÿØÿßŸÑÿ© ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ID ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ≠ÿßŸÑŸä
  function getCurrentUserId() {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get('user') || localStorage.getItem("activeUser");
  }
  
  // ÿßÿ≥ÿ™ÿØÿπÿßÿ° ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ© Ÿàÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
  window.addEventListener('DOMContentLoaded', updateMetaTags);
  window.addEventListener('hashchange', updateMetaTags);
</script>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script>
  // Enhanced QR Code generation with better error handling
  async function generateQRCode(containerId, text, errorId) {
    const container = document.getElementById(containerId);
    const errorElement = document.getElementById(errorId);
    
    try {
      container.innerHTML = '';
      errorElement.style.display = 'none';
      
      if (!QRCode || typeof QRCode.toCanvas !== 'function') {
        throw new Error('QRCode library not loaded correctly.');
      }
      
      const canvas = document.createElement('canvas');
      container.appendChild(canvas);
      
      await QRCode.toCanvas(canvas, text, {
        width: 150,
        errorCorrectionLevel: 'H',
        margin: 1,
        color: {
          dark: '#000000',
          light: '#FFFFFF'
        }
      });
      
      return true;
    } catch (error) {
      console.error('QR Code generation failed:', error);
      errorElement.textContent = '‚ö†Ô∏è Failed to generate QR code. Displaying link instead.';
      errorElement.style.display = 'block';
      
      container.innerHTML = `
        <div style="word-break: break-all; font-family: 'minecraft'; 
             font-size: 12px; color: white; padding: 10px; 
             background: #333; border-radius: 5px;">
          ${text}
        </div>
      `;
      return false;
    }
  }
  
  // Share Profile functionality
  document.getElementById('shareProfileBtn').addEventListener('click', async function() {
    const userId = localStorage.getItem("activeUser");
    if (!userId) {
      alert('üîí You need to be logged in to share your profile');
      return;
    }
    
    const profileLink = `${window.location.origin}/mc.community/pages/profile.html?user=${userId}`;
    document.getElementById('profileLink').value = profileLink;
    
    const btn = this;
    btn.disabled = true;
    const originalText = btn.textContent;
    btn.textContent = 'üîÑ Generating...';
    
    try {
      await generateQRCode('qrCodeContainer', profileLink, 'qrCodeError');
      toggleModal('shareProfileModal', true);
    } catch (error) {
      console.error('QR code generation completely failed:', error);
      alert('‚ö†Ô∏è Failed to generate shareable content. Please try again later.');
    } finally {
      btn.textContent = originalText;
      btn.disabled = false;
    }
  });
  
  // Copy link functionality
  document.getElementById('copyLinkBtn').addEventListener('click', function() {
    const profileLink = document.getElementById('profileLink');
    profileLink.select();
    document.execCommand('copy');
    
    const originalText = this.textContent;
    this.textContent = '‚úÖ Copied!';
    setTimeout(() => {
      this.textContent = originalText;
    }, 2000);
  });
  
  // Modal functions
  function toggleModal(modalId, show) {
    const modal = document.getElementById(modalId);
    if (modal) {
      modal.style.display = show ? 'flex' : 'none';
    } else {
      console.error('Modal not found:', modalId);
    }
  }

  // Close share modal
  document.getElementById('closeShareModal').addEventListener('click', () => toggleModal('shareProfileModal', false));
  document.getElementById('closeShareModalBtn').addEventListener('click', () => toggleModal('shareProfileModal', false));
</script>

  <!-- ÿ®ÿßŸÇŸä ÿßŸÑÿ≥ŸÉÿ±Ÿäÿ®ÿ™ÿßÿ™ ÿ™ÿ®ŸÇŸâ ŸÉŸÖÿß ŸáŸä -->

      <script>
window.addEventListener('scroll', function() {
  const header = document.querySelector('.sticky-header');
  if (window.scrollY > 0) {
    header.classList.add('sticky');
  } else {
    header.classList.remove('sticky');
  }
});
</script>
      <script>  
        function goBack() {  
            if (window.history.length > 1) {  
                window.history.back();  
            } else {  
                window.location.href = '/';
            }  
        }  
    </script>
</body>
