<!DOCTYPE html>  
<html>  
<head>  
  <meta charset="UTF-8">  
  <meta name="viewport" content="width=device-width, initial-scale=1">  
  <title>Register page</title>  
  <link rel="icon" type="image/x-icon" href="../web/ytlogo.png">  
  <link rel="stylesheet" href="../style/main.css">    
  <style>  
    @font-face {  
      font-family: minecraft;  
      src: url('../font/Minecraft-Default.otf');  
    }  
    @font-face {  
      font-family: minecraft-ten;  
      src: url('../font/Minecraft-Ten.ttf');  
    }  
    @font-face {  
      font-family: minecraft-five;  
      src: url('../font/Minecraft-Five.ttf');  
    }  
  
    .note {  
        background: #222;  
        border: 3px solid #FFBC13;  
        box-shadow: 0px 3px 0px rgba(139, 92, 0, 1);   
        text-align: center;  
        color: white;  
        width: auto;  
        padding: 5px  
    }  
    .note note {  
        background: #FFBC13;  
        color: black;  
        border: 1px solid goldenrod;  
        padding: 5px;  
        font-weight: bold;  
        height: 24px;   
    }  
    p {  
      color: #FFFFFF  
    }  
    .note button {  
        background: #FFBC13;  
        color: black;  
        border: 1px solid goldenrod;  
        padding: 5px;  
        font-weight: bold;  
        height: 24px;   
    }  
    .password-container {  
      position: relative;  
      margin: 10px 0;  
    }
    
    .toggle-password {
      position: absolute;
      margin-top: 11px;
      transform: translateY(-50%);
      transform: translateX(-150%);
      cursor: pointer;
      user-select: none;
      opacity: 0.7;
    }
    
    .toggle-password:hover {
      opacity: 1;
    }
    
    .input-group {
      position: relative;
    }
    
    .input-group input {
      outline: none;
      font-size: 16px;
    }
    
    .input-group label {
      position: absolute;
      top: 12px;
      left: 30%;
      color: #484848;
      font-family: minecraft;
      transition: all 0.3s;
      pointer-events: none;
      background-color: transparent;
      padding: 0 5px;
    }
    
    .input-group input:focus + label,
    .input-group input:not(:placeholder-shown) + label {
      top: -10px;
      border-radius: 10px;
      left: 30%;
      font-size: 14px;
      background-color: rgba(38, 38, 38);
      color: #999999;
    }
    
    /* Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
    .register-container {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: center;
      gap: 50px;
      padding: 20px;
    }
    
    .register-box {
      flex: 1;
      max-width: 400px;
    }
    
    .register-image {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    .register-image img {
      max-width: 100%;
      height: auto;
    }
    
    /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬ÙˆØ§Ù„ */
    @media (max-width: 768px) {
      .register-container {
        flex-direction: column;
        gap: 20px;
      }
      
      .register-image {
        order: 2;
        margin-top: 20px;
      }
      
      .register-box {
        order: 1;
        width: 100%;
      }
    }
    /* Ø¥Ø¶Ø§ÙØ© Ø£Ù†Ù…Ø§Ø· Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµØ­Ø© */
.input-group input.valid {
  border: 2px solid #4CAF50 !important; /* Ø£Ø®Ø¶Ø± Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµØ­ÙŠØ­Ø© */
  box-shadow: 0 2px 0 rgba(27, 160, 0, 1);
}

.input-group input.invalid {
  border: 2px solid #f44336 !important; /* Ø£Ø­Ù…Ø± Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§Ø·Ø¦Ø© */
  box-shadow: 0 2px 0 rgba(160, 0, 0, 1);
}

.input-group input {
  transition: border 0.3s ease;
  border: 2px solid #313131D1 !important; /* Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ */
}
  </style> 
</head>  
<body>  
  <button class="back" id="backButton" type="button" onclick="goBack()"></button>
  <div class="header"> register  <img src="../imag/gif_test-83efe.gif" height="30">  </div>
  
  <div class="content">
    <div class="register-container">
      <div class="register-box">  
        <form id="loginForm">  
          
          <br>
          <div class="title">register box</div>
          <div class="input-group">
            <input type="text" id="username" placeholder=" " required>  
            <label for="username">Username</label>
                        <span class="icon"></span>
          </div>
          
          <div class="password-container">
            <div class="input-group password-container">
              <input type="password" id="password" placeholder="" required>
              <label for="password">password</label>
              <span class="toggle-password">ï¸ğŸ™‰</span> 
            </div>
          </div>
          
          <div class="input-group">
            <input type="email" id="email" placeholder=" " required>  

            <label for="email">Your email</label>
                        <span class="icon"></span>
          </div>
          <br>   
        <div> 
          <div class="description">  
            <div class="button">   
              <button type="button" id="whiteButton"> Register <img src="../imag/add-player@0.5x.icon-2f437.png" height="15"></button>  
            </div>  
          </div>
        </div>
       </form>
      </div>
      <div class="register-image">
        <div class="description"> 
      <img src="../imag/no-worlds-yet-art-446b1.png" alt="Register Image">
      </div>
      </div>
    </div>
  </div>    
  
<script type="module">  
    import { db } from '../scripts/main.js';
    import { doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";   
  
    // Ø¹Ù†Ø§ØµØ± DOM
    const togglePassword = document.querySelector('.toggle-password');
    const passwordInput = document.getElementById('password');
    const usernameInput = document.getElementById('username');
    const emailInput = document.getElementById('email');
    
    // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµØ­Ø©
    function validateUsername(username) {
      return username.length >= 3 && /^[a-zA-Z0-9_]+$/.test(username);
    }
    
    function validatePassword(password) {
      return password.length >= 6;
    }
    
    function validateEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ù„Ù„Ø£Ø­Ø¯Ø§Ø«
    togglePassword.addEventListener('click', function () {
      const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordInput.setAttribute('type', type);
      this.textContent = type === 'password' ? 'ï¸ğŸ™ˆ' : 'ï¸ğŸ™‰';
    });
    
    usernameInput.addEventListener('input', function() {
      this.classList.toggle('valid', validateUsername(this.value));
      this.classList.toggle('invalid', !validateUsername(this.value));
    });
    
    passwordInput.addEventListener('input', function() {
      this.classList.toggle('valid', validatePassword(this.value));
      this.classList.toggle('invalid', !validatePassword(this.value));
    });
    
    emailInput.addEventListener('input', function() {
      this.classList.toggle('valid', validateEmail(this.value));
      this.classList.toggle('invalid', !validateEmail(this.value));
    });
    
    // Ø­Ø¯Ø« ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨
    document.getElementById('whiteButton').addEventListener('click', async function () {  
      const username = usernameInput.value.trim();  
      const password = passwordInput.value.trim();  
      const email = emailInput.value.trim();  
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµØ­Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
      const isUsernameValid = validateUsername(username);
      const isPasswordValid = validatePassword(password);
      const isEmailValid = validateEmail(email);
      
      if (!isUsernameValid || !isPasswordValid || !isEmailValid) {
        alert('Please fill in the fields correctlyğŸ’¡\n Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø¨Ø·Ø±ÙŠÙ‚Ø© ØµØ­ÙŠØ­Ø© ğŸ’¡', 'error');
        return;
      }
  
      try {
        const userDocRef = doc(db, 'users', username);
        const userDoc = await getDoc(userDocRef);  

        if (userDoc.exists()) {  
          alert('Username already exists âŒ', 'error');  
          return;  
        }  

        await setDoc(userDocRef, { 
          password, 
          points: 0, 
          email: email
        });  
        
        localStorage.setItem('activeUser', username);
        alert(`Account created successfully âœ…, welcome ${username}.âœ¨`, 'success');  
        
        setTimeout(() => {
          window.location.href = 'general.html';
        }, 500);
        
      } catch (error) {  
        console.error('Error:', error);  
        alert('An error occurred. Please try again.', 'error');  
      }
    });  
</script>
  <script>
    function goBack() {
      if (window.history.length > 1) {
        window.history.back();
      } else {
        window.location.href = '/'; // ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù…ÙˆÙ‚Ø¹Ùƒ
      }
    }
  </script>
</body>   
</html>